<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Dishes</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style type="text/css">
        body {
            width: 800px;
            margin: auto;
            font-family: Arial, sans-serif;
        }
        h1 {
            color: #333;
        }
        .actions {
            text-align: center;
        }
        .actions a, .actions form {
            display: inline-block;
            margin: 0 5px;
        }
        .add-button {
            margin: 20px 0;
        }
        .chef-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .chef-list li {
            display: inline-block;
            margin: 2px 5px;
            padding: 2px 8px;
            background-color: #f5f5f5;
            border-radius: 3px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
<header>
    <h1>All Dishes</h1>
    <div class="mt-3 mb-3" sec:authorize="isAuthenticated()">
        <form action="/logout" method="post" style="display: inline;">
            <button type="submit" class="btn btn-secondary">Logout</button>
        </form>
    </div>
    </div>
</header>
<main>
    <div class="add-button" sec:authorize="hasRole('ADMIN')">
        <form method="get" action="/dishes/dish-form">
            <input type="submit" value="Add new dish">
        </form>
    </div>

    <div th:if="${dishes != null && dishes.size() > 0}">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>Dish ID</th>
                <th>Name</th>
                <th>Cuisine</th>
                <th>Preparation Time</th>
                <th>Preparation Date</th>
                <th>Chefs</th>
                <th sec:authorize="hasRole('ADMIN')">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="dish : ${dishes}">
                <td th:text="${dish.dishId}"></td>
                <td th:text="${dish.name}"></td>
                <td th:text="${dish.cuisine}"></td>
                <td th:text="${dish.preparationTime}"></td>
                <td th:text="${dish.preparationDate}"></td>
                <td>
                    <ul class="chef-list" th:if="${dish.chefs != null && !dish.chefs.isEmpty()}">
                        <li th:each="chef : ${dish.chefs}"
                            th:text="${chef.firstName + ' ' + chef.lastName}">
                        </li>
                    </ul>
                    <span th:if="${dish.chefs == null || dish.chefs.isEmpty()}">No chefs assigned</span>
                </td>
                <td class="actions" sec:authorize="hasRole('ADMIN')">
                    <a th:href="@{'/dishes/dish-form/{id}' (id=${dish.id})}">Edit</a>
                    <form th:action="@{'/dishes/delete/{id}' (id=${dish.id})}"
                          method="POST"
                          style="display: inline;">
                        <input type="submit"
                               value="Delete"
                               onclick="return confirm('Are you sure you want to delete this dish?')">
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${dishes == null || dishes.size() == 0}">
        <p>No dishes available. Add a new dish to get started.</p>
    </div>
</main>
</body>
</html>